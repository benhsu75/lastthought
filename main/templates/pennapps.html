<!DOCTYPE html>
<html>
<head>
    <title>Insupen</title>
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static 'pennapps.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    </head>
<body>
    <div class="navbar">InsuPen</div>
    <div class="last-injection-container">
        <div class="last-injection-text">
        Your last dose of <span class="last-num-units">2 units</span> was <span class="last-num-hours">2 hours</span> ago.
        </div>
    </div>
    <div class="circle-container">
        <div class="circle">
            <input type="number" step="0.01" class="insulin-amount" value="{{ amount }}" />
            <div class="units-text">units of Insulin</div>
        </div>
    </div>
    <div class="doses-container">
        <div class="doses-header">
            <div class="left">
                
            </div><div class="day">Today</div><div class="right">
                
            </div>
        </div>
        <div class="doses-body">
            <div class="back-in-time">
                
            </div><div class="doses-list"> 
                {% for d in doses %}
                <div class="dose">
                    <span class="num-units">{{ d.amount }} units</span> - {{ d.get_time_diff_from_now }} ago
                </div>
                {% endfor %}
            </div><div class="forward-in-time">
                
            </div>
        </div>
    </div>
    <div class="bg-container">
        <canvas id="myChart" width="250" height="150"></canvas>
    </div>

    <!-- chart js -->
    <!-- <script type="{% static 'js/chartjs/Chart.js' %}"></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.js"></script> 

    <script type="text/javascript">
        $(document).ready(function() {

            document.addEventListener('touchstart', function(e) {
                document.activeElement.blur();
            }, false);

            $('.insulin-amount').click(function(e) {
                console.log('insulin amount');
                e.stopImmediatePropagation();
            });

            $('.insulin-amount').change(function() {

                var amount = $('.insulin-amount').val();

                if(!isNaN(amount)) {
                    // Ajax
                    var payload = {
                        amount: parseFloat(amount)
                    };

                    // POST to /habits
                    $.ajax({
                        method: 'POST',
                        url: '/set_insulin_amount/',
                        data: payload,
                        success: function() {
                            // Clear fields
                            console.log('SAVED');
                        }
                    })
                }

            });

            var data = {
                labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                datasets: [
                    {
                        label: "Blood Glucose Levels",
                        fillColor: "rgba(220,220,220,0.2)",
                        strokeColor: "rgba(220,220,220,1)",
                        pointColor: "rgba(220,220,220,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(220,220,220,1)",
                        data: [2, 3, 5, 7, 11, 13, 17, 19, 23, 29]
                    }
                ]
            };
            var options = {
                showLines : true,
                scales: {
                    xAxes: [{
                        display: false
                    }]
                },
                legend: {
                    display: false
                }
            };

            var ctx = document.getElementById("myChart");

            var myLineChart = Chart.Line(ctx, {
                data: data,
                options: options
            });

        });
    </script>
</body>
</html>